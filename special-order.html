<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ุทูุจ ุงูุนุฑุถ ุงูุฎุงุต</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
      font-size: 18px;
      line-height: 1.6;
    }

    .box {
      background: #222;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, select, textarea, button {
      padding: 12px;
      margin-top: 5px;
      width: 100%;
      border: none;
      border-radius: 6px;
      background-color: #e5c9a0;
      color: #000;
      font-size: 18px;
    }

    button {
      cursor: pointer;
      margin-top: 20px;
    }

    #region-group {
      display: none;
    }
  </style>
</head>
<body>

  <h2>๐๏ธ ุทูุจ ุงูุนุฑุถ ุงูุฎุงุต</h2>

  <div class="box">
    <p><strong>ุงูููุชุฌ:</strong> <span id="product-name"></span></p>
    <p><strong>ุงูุณุนุฑ:</strong> <span id="product-price"></span></p>
    <p><strong>ุงููููุฉ:</strong> <span id="product-quantity"></span></p>
    <p><strong>ููุงุท ุงูููุงุก:</strong> <span id="product-points"></span></p>
  </div>

  <form onsubmit="submitOrder(event)">
    <label>ุงูุงุณู ุงููุงูู:</label>
    <input type="text" id="customer-name" required>

    <label>ุฑูู ูุงุชุณุงุจ ุฅูุงุฑุงุชู:</label>
    <input type="tel" id="customer-phone" placeholder="05..." required>

    <label>ุงูุฅูุงุฑุฉ:</label>
    <select id="emirate" onchange="showRegion()" required>
      <option value="">ุงุฎุชุฑ ุงูุฅูุงุฑุฉ</option>
      <option value="ุฏุจู">ุฏุจู</option>
      <option value="ุฃุจูุธุจู">ุฃุจูุธุจู</option>
      <option value="ุงูุดุงุฑูุฉ">ุงูุดุงุฑูุฉ</option>
      <option value="ุนุฌูุงู">ุนุฌูุงู</option>
      <option value="ุฑุฃุณ ุงูุฎููุฉ">ุฑุฃุณ ุงูุฎููุฉ</option>
      <option value="ุฃู ุงูููููู">ุฃู ุงูููููู</option>
      <option value="ุงููุฌูุฑุฉ">ุงููุฌูุฑุฉ</option>
    </select>

    <div id="region-group">
      <label>ุงูููุทูุฉ:</label>
      <input type="text" id="region" required>
    </div>

    <button type="submit">๐จ ุชุฃููุฏ ุงูุทูุจ ุนุจุฑ ูุงุชุณุงุจ</button>
  </form>
<hr>
<h3>๐ ุนุฑุถ ุฑุตูุฏู</h3>
<input type="tel" id="check-phone" placeholder="ุฃุฏุฎู ุฑููู ุงูุฅูุงุฑุงุชู">
<button onclick="checkPoints()">ุนุฑุถ ุงูุฑุตูุฏ</button>
<p id="points-result"></p>
  <hr>
<h3>๐ ุงุณุชุจุฏุงู ุงูุฑุตูุฏ</h3>
<input type="tel" id="redeem-phone" placeholder="ุฃุฏุฎู ุฑููู ุงูุฅูุงุฑุงุชู">
<button onclick="showRedeemOptions()">ุงุณุชุจุฏุงู ุงูุฑุตูุฏ</button>
<div id="redeem-options" style="margin-top:15px;"></div>
<p id="redeem-result"></p>
  <script>
    // ูุฑุงุกุฉ ุจูุงูุงุช ุงูุนุฑุถ ูู ุงูุฑุงุจุท
    const params = new URLSearchParams(window.location.search);
    const name = params.get("name") || "";
    const price = params.get("price") || "";
    const quantity = params.get("quantity") || "";
    const points = params.get("points") || "0";

    // ุชุนุจุฆุฉ ุชูุงุตูู ุงูุนุฑุถ
    document.getElementById("product-name").textContent = name;
    document.getElementById("product-price").textContent = price + " ุฏุฑูู";
    document.getElementById("product-quantity").textContent = quantity + " ูุฑูุฒ";
    document.getElementById("product-points").textContent = points + " ููุทุฉ";

    // ุฅุธูุงุฑ ุญูู ุงูููุทูุฉ ุนูุฏ ุงุฎุชูุงุฑ ุงูุฅูุงุฑุฉ
    function showRegion() {
      const emirate = document.getElementById("emirate").value;
      document.getElementById("region-group").style.display = emirate ? "block" : "none";
    }

    // ุฅุฑุณุงู ุงูุทูุจ ุฅูู ูุงุชุณุงุจ ูุญูุธ ุงูููุงุท
    function submitOrder(e) {
  e.preventDefault();

  const customerName = document.getElementById("customer-name").value.trim();
  const phone = document.getElementById("customer-phone").value.trim();
  const emirate = document.getElementById("emirate").value;
  const region = document.getElementById("region").value.trim();

  if (!phone.startsWith("05")) {
    alert("ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุฅูุงุฑุงุชู ูุจุฏุฃ ุจู 05");
    return;
  }

  // ุชุฌููุฒ ุฑุณุงูุฉ ูุงุชุณุงุจ
  let message = `๐๏ธ ุทูุจ ุนุฑุถ ุฎุงุต\n`;
  message += `๐ค ุงูุงุณู: ${customerName}\n`;
  message += `๐ฑ ุงูุฑูู: ${phone}\n`;
  message += `๐๏ธ ุงูุฅูุงุฑุฉ: ${emirate}\n`;
  message += `๐ ุงูููุทูุฉ: ${region}\n`;
  message += `\n๐ฆ ุงูููุชุฌ: ${name}\n`;
  message += `๐ฆ ุงููููุฉ: ${quantity} ูุฑูุฒ\n`;
  message += `๐ฐ ุงูุณุนุฑ: ${price} ุฏุฑูู\n`;
  message += `๐ฏ ููุงุท ุงูููุงุก ุงูููุชุณุจุฉ: ${points}\n`;

  const encoded = encodeURIComponent(message);
  const myNumber = "963960048355";
  window.open(`https://wa.me/${myNumber}?text=${encoded}`, "_blank");

  // ุญูุธ ุงูููุงุท ุจุนุฏ ูุชุญ ูุงุชุณุงุจ
  const query = new URLSearchParams({
    name: customerName,
    phone: phone,
    points: points,
    source: `ุนุฑุถ ุฎุงุต: ${name}`
  }).toString();

  fetch(`https://script.google.com/macros/s/AKfycby_lJ6JAqPEhi1ucJbT9FNg-0SGPirTtmb3CS53RqxoosbG8W0dm6tgYaDD6Ouj96nwfA/exec?${query}`)
    .then(res => res.text())
    .then(txt => {
      document.getElementById("save-status").textContent = "๐ ุฑุฏ ุงูุณูุฑุจุช: " + txt;
    })
    .catch(err => {
      document.getElementById("save-status").textContent = "โ ุฎุทุฃ ุจุงูุญูุธ: " + err.message;
    });
}
    function checkPoints() {
  const phone = document.getElementById("check-phone").value.trim();

  if (!phone.startsWith("05")) {
    alert("ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุฅูุงุฑุงุชู ูุจุฏุฃ ุจู 05");
    return;
  }

  const query = new URLSearchParams({
    phone: phone,
    check: "true"
  }).toString();

  fetch(`https://script.google.com/macros/s/AKfycby62ahFxkL0N4GYhEJZzuOC7Yk-3XdKYqi6KanLqyhj4uOjDzYZecaJx4UAF4tT6Cs93A/exec?${query}`)
    .then(res => res.text())
    .then(txt => {
      document.getElementById("points-result").textContent = txt;
    })
    .catch(err => {
      document.getElementById("points-result").textContent = "โ ุฎุทุฃ: " + err.message;
    });
                                                }
    function showRedeemOptions() {
  const phone = document.getElementById("redeem-phone").value.trim();
  if (!phone.startsWith("05")) {
    alert("ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุฅูุงุฑุงุชู ูุจุฏุฃ ุจู 05");
    return;
  }

  const query = new URLSearchParams({
    phone: phone,
    check: "true"
  }).toString();

  fetch(`https://script.google.com/macros/s/AKfycby_lJ6JAqPEhi1ucJbT9FNg-0SGPirTtmb3CS53RqxoosbG8W0dm6tgYaDD6Ouj96nwfA/exec?${query}`)
    .then(res => res.text())
    .then(txt => {
      const points = parseInt(txt.replace(/\D/g, ""));
      let html = `<p>ุฑุตูุฏู ุงูุญุงูู: ${points} ููุทุฉ</p>`;
      html += `<label>ุงุฎุชุฑ ููุน ุงูุงุณุชุจุฏุงู:</label><select id="reward-choice">`;

      if (points >= 1) html += `<option value="ุฎุตู">ุฎุตู ูุนุงุฏู ุนุฏุฏ ุงูููุงุท</option>`;
      if (points >= 15) html += `<option value="ูุฏูุฉ ุฑูุฒูุฉ">ูุฏูุฉ ุฑูุฒูุฉ (15 ููุทุฉ)</option>`;
      if (points >= 25) html += `<option value="ูุฑูุฒ ูุฌุงูู">ูุฑูุฒ ูุฌุงูู ูู ุงุฎุชูุงุฑู (25 ููุทุฉ)</option>`;
      if (points >= 75) html += `<option value="ุทูุจ ูุฌุงูู">ุทูุจ ูุฌุงูู (5 ูุฑูุฒ) (75 ููุทุฉ)</option>`;

      html += `</select><button onclick="redeemPoints('${phone}')">ุชุฃููุฏ ุงูุงุณุชุจุฏุงู</button>`;
      document.getElementById("redeem-options").innerHTML = html;
    })
    .catch(err => {
      document.getElementById("redeem-options").textContent = "โ ุฎุทุฃ: " + err.message;
    });
}

function redeemPoints(phone) {
  const reward = document.getElementById("reward-choice").value;
  const query = new URLSearchParams({
    phone: phone,
    redeem: "true",
    reward: reward
  }).toString();

  fetch(`https://script.google.com/macros/s/AKfycby_lJ6JAqPEhi1ucJbT9FNg-0SGPirTtmb3CS53RqxoosbG8W0dm6tgYaDD6Ouj96nwfA/exec?${query}`)
    .then(res => res.text())
    .then(txt => {
      document.getElementById("redeem-result").textContent = txt;
      document.getElementById("redeem-options").innerHTML = "";
    })
    .catch(err => {
      document.getElementById("redeem-result").textContent = "โ ุฎุทุฃ: " + err.message;
    });
        }
  </script>

</body>
</html>
