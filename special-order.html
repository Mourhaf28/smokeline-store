<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>طلب العرض الخاص</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet">
  <style>
  body {
    background: #0f0f0f;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    padding: 25px;
    font-size: 21px;
    line-height: 1.7;
  }

  h2, h3 {
    font-size: 28px;
    color: #e5c9a0;
    text-align: center;
    margin-bottom: 20px;
  }

  .box {
    background: #1c1c1c;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    border: 1px solid #333;
    box-shadow: 0 0 10px rgba(229, 201, 160, 0.2);
    font-size: 20px;
  }

  label {
    display: block;
    margin-top: 18px;
    font-weight: bold;
    font-size: 20px;
  }

  input, select, textarea, button {
    padding: 14px;
    margin-top: 8px;
    width: 100%;
    border: none;
    border-radius: 8px;
    background-color: #e5c9a0;
    color: #000;
    font-size: 20px;
    transition: box-shadow 0.3s;
  }

  input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 5px #d4af37;
    outline: none;
  }

  button {
    cursor: pointer;
    margin-top: 22px;
    background-color: #d4af37;
    color: #000;
    font-weight: bold;
    font-size: 20px;
  }

  button:hover {
    background-color: #f0d88a;
  }

  #region-group {
    display: none;
  }

  #save-status, #points-result, #redeem-result {
    margin-top: 22px;
    color: #e5c9a0;
    font-weight: bold;
    text-align: center;
    font-size: 20px;
  }

  hr {
    border: none;
    border-top: 1px solid #444;
    margin: 45px 0 25px;
  }
</style>

</head>
<body>

  <h2>🛍️ طلب العرض الخاص</h2>

  <div class="box">
    <p><strong>المنتج:</strong> <span id="product-name"></span></p>
    <p><strong>السعر:</strong> <span id="product-price"></span></p>
    <p><strong>الكمية:</strong> <span id="product-quantity"></span></p>
    <p><strong>نقاط الولاء:</strong> <span id="product-points"></span></p>
  </div>

  <form onsubmit="submitOrder(event)">
    <label>الاسم الكامل:</label>
    <input type="text" id="customer-name" required>

    <label>رقم واتساب إماراتي:</label>
    <input type="tel" id="customer-phone" placeholder="05..." maxlength="10" autocomplete="off" required>

    <label>الإمارة:</label>
    <select id="emirate" onchange="showRegion()" required>
      <option value="">اختر الإمارة</option>
      <option value="دبي">دبي</option>
      <option value="أبوظبي">أبوظبي</option>
      <option value="الشارقة">الشارقة</option>
      <option value="عجمان">عجمان</option>
      <option value="رأس الخيمة">رأس الخيمة</option>
      <option value="أم القيوين">أم القيوين</option>
      <option value="الفجيرة">الفجيرة</option>
    </select>

    <div id="region-group">
      <label>المنطقة:</label>
      <input type="text" id="region" required>
    </div>

    <button type="submit">📨 تأكيد الطلب عبر واتساب</button>
  </form>

  <p id="save-status"></p>

  <hr>
  <h3>📊 عرض رصيدي</h3>
  <input type="tel" id="check-phone" placeholder="أدخل رقمك الإماراتي" maxlength="10" autocomplete="off">
  <button onclick="checkPoints()">عرض الرصيد</button>
  <p id="points-result"></p>
<script>
  const params = new URLSearchParams(window.location.search);
  const name = params.get("name") || "";
  const price = params.get("price") || "";
  const quantity = params.get("quantity") || "";
  const points = params.get("points") || "0";

  document.getElementById("product-name").textContent = name;
  document.getElementById("product-price").textContent = price + " درهم";
  document.getElementById("product-quantity").textContent = quantity + " كروز";
  document.getElementById("product-points").textContent = points + " نقطة";

  function showRegion() {
    const emirate = document.getElementById("emirate").value;
    document.getElementById("region-group").style.display = emirate ? "block" : "none";
  }

  function submitOrder(e) {
    e.preventDefault();

    const customerName = document.getElementById("customer-name").value.trim();
    const phone = document.getElementById("customer-phone").value.trim();
    const formattedPhone = phone;
    const emirate = document.getElementById("emirate").value;
    const region = document.getElementById("region").value.trim();

    if (!phone.startsWith("05")) {
      alert("يرجى إدخال رقم إماراتي يبدأ بـ 05");
      return;
    }

    document.getElementById("save-status").textContent = "📡 جاري حفظ النقاط...";

    let message = `🛍️ طلب عرض خاص\n`;
    message += `👤 الاسم: ${customerName}\n`;
    message += `📱 الرقم: ${phone}\n`;
    message += `🏙️ الإمارة: ${emirate}\n`;
    message += `📍 المنطقة: ${region}\n`;
    message += `\n📦 المنتج: ${name}\n`;
    message += `📦 الكمية: ${quantity} كروز\n`;
    message += `💰 السعر: ${price} درهم\n`;
    message += `🎯 نقاط الولاء المكتسبة: ${points}\n`;

    const encoded = encodeURIComponent(message);
    const myNumber = "963960048355";
    window.open(`https://wa.me/${myNumber}?text=${encoded}`, "_blank");

    const query = new URLSearchParams({
      name: customerName,
      phone: formattedPhone,
      points: points,
      source: `عرض خاص: ${name}`
    }).toString();

    fetch(`https://script.google.com/macros/s/AKfycbx8C3m8sAwYw-_jP-jJgGS-xmYVIHvEjlFqPPnSyDLXt-GRxnM2_ZGVDmbDYMb2aqkx/exec?${query}`)
      .then(res => res.text())
      .then(txt => {
        document.getElementById("save-status").textContent = "📌 رد السكربت: " + txt;
      })
      .catch(err => {
        document.getElementById("save-status").textContent = "❌ خطأ بالحفظ: " + err.message;
      });
  }

  function checkPoints() {
    const phone = document.getElementById("check-phone").value.trim();

    if (!phone.startsWith("05")) {
      alert("يرجى إدخال رقم إماراتي يبدأ بـ 05");
      return;
    }

    const query = new URLSearchParams({
      phone: phone,
      check: "true"
    }).toString();

    fetch(`https://script.google.com/macros/s/AKfycbx8C3m8sAwYw-_jP-jJgGS-xmYVIHvEjlFqPPnSyDLXt-GRxnM2_ZGVDmbDYMb2aqkx/exec?${query}`)
      .then(res => res.text())
      .then(txt => {
        document.getElementById("points-result").textContent = txt;
      })
      .catch(err => {
        document.getElementById("points-result").textContent = "❌ خطأ: " + err.message;
      });
  }
</script>

</body>
</html>
